function LocationsDataModel(){"use strict";var e=this;e.locations=[{name:"Wally Weekes Pool",suburb:"North Bondi",img:"img/Wally-Weekes.png",rockPool:!0,info:"A very popular pool to take the kids as it’s a tidal pool that was transformed into a rock pool.",lat:-33.891492,lng:151.282316},{name:"Bondi Baths",suburb:"Bondi",img:"img/Bondi-Baths.png",rockPool:!1,info:"The Bondi Baths are the home of the Bondi Icebergs Winter Swimming Club and is located at the southern end of Bondi Beach and have been a land mark for over 100 years.",lat:-33.895028,lng:151.27457},{name:"Bronte Baths",suburb:"Bronte",img:"img/Bronte-Baths.png",rockPool:!0,info:"Probably the most photographed of all of Sydney’s rock pools. Just along the Southern Coastal Walk. Bronte park as working bbqs a wonderful place to go for a evening swim then bbq with friends afterwards.",lat:-33.905049,lng:151.269079},{name:"Clovelly Ocean Pool",suburb:"Clovelly",img:"img/Clovelly-Pool.png",rockPool:!1,info:"A saltwater lap pool located next to Clovelly Beach on the concrete promenade.",lat:-33.914189,lng:151.266941},{name:"Giles Baths",suburb:"Coogee",img:"img/Giles-Baths.png",rockPool:!0,info:"A popular swimming hole with young people and a fun place to explore from Coogee Beach. It’s located at the foot of the northern headland.",lat:-33.920017,lng:151.260641},{name:"Ross Jones Memorial Pool",suburb:"Coogee",img:"img/Ross-Jones.png",rockPool:!1,info:"Located at the southern end of Coogee Beach, this man-made ocean pool is lots of fun for the family and gets crowded on a hot summer’s day.",lat:-33.922878,lng:151.257858},{name:"McIver's Baths",suburb:"Coogee",img:"img/McIvers.png",rockPool:!1,info:"The last remaining women’s-only seawater baths in Australia. There's a large concrete sea pool, brick sunbathing area, amenities block, change rooms and small clubhouse.",lat:-33.924103,lng:151.25839},{name:"Wylie's Bath",suburb:"Coogee",img:"img/Wylies.png",rockPool:!1,info:"An iconic sight on the Coogee ocean landscape, Wylies Baths was built in 1907 and enjoys stunning views across Coogee Bay.",lat:-33.925476,lng:151.2591},{name:"Ivor Rowe Rockpool",suburb:"South Coogee",img:"img/Ivor-Rowe.png",rockPool:!0,info:"One of the smallest ocean pools along the Coastal Walkway. It is a natural, shallow rock pool and perfect for wading or cooling down on a hot day.",lat:-33.933177,lng:151.261701},{name:"Mahon Pool",suburb:"Maroubra",img:"img/Mahon-Pool.png",rockPool:!0,info:"The Mahon rock pool is located to the north of Maroubra Beach at the base of Jack Vanny Reserve. The exposed rock outcrops and cliffs above make it a spectacular venue and it is the home of the Maroubra Seals Winter Swimming Club.",lat:-33.942808,lng:151.263836},{name:"Malabar Pool",suburb:"Malabar",img:"img/Malabar-Ocean-Pool.png",rockPool:!1,info:"Malabar Ocean Pool is located near Malabar Beach in Long Bay directly below Randwick Golf Club. It has spectacular views over Long Bay and onto the Randwick Rifle Range.",lat:-33.968516,lng:151.254552}]}function LocationsViewModel(e){"use strict";var o=this;o.data=e,o.selectedLocation=ko.observable(),o.filterText=ko.observable(""),o.rockPool=ko.observable(!0),o.manMade=ko.observable(!0),o.locationArray=ko.pureComputed(function(){var t=e.locations,a=o.filterText().toLowerCase(),i=0===a.length;return ko.utils.arrayFilter(t,function(e){return(i||0===e.name.toLowerCase().indexOf(a)||0===e.suburb.toLowerCase().indexOf(a))&&(o.rockPool()&&e.rockPool||o.manMade()&&!e.rockPool)})}).extend({throttle:100}),o.displayFlickr=function(){window.location.href="#flickr",flickrViewModel.resize()},o.displayWeather=function(){window.location.href="#weather",weatherViewModel.resize()},o.setSelected=function(e){o.selectedLocation(e)},o.resize=function(){var e=$("#location-list");e.height($(window).height()-e.offset().top)},o.topRight=function(){var e=$("#location-list"),o=e.offset();return $("#search").width(e.width()-5),o.left=o.left<0?0:e.width()+1,o};var t=function(){var e=o.selectedLocation();e&&e.selected(!1),this.selected(!0),o.selectedLocation(this)};for(var a in e.locations){var i=e.locations[a];i.ordinal=Number(a)+1,i.selected=ko.observable(!1),i.parent=o,i.select=t.bind(i)}o.resize()}function MapViewModel(e){"use strict";var o=this;o.viewModel=e,google.maps.event.addDomListener(window,"load",function(){o.initializeMap()}),e.selectedLocation.subscribe(function(e){o.infoWindow.close(),o.map.setCenter(e.marker.position),e.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setAnimation(null)},700),o.infoWindow.open(o.map,e.marker)}),o.initializeMap=function(){function e(e,t){return t.marker=new google.maps.Marker({map:o.map,position:new google.maps.LatLng(t.lat,t.lng),icon:"http://chart.apis.google.com/chart?chst=d_bubble_icon_text_small_withshadow&chld=swim|edge_bl|"+e+"|74AAF7|fff",title:t.name}),google.maps.event.addListener(t.marker,"click",function(){t.select()}),t.marker.position}var t={zoom:12,mapTypeId:google.maps.MapTypeId.HYBRID};o.map=new google.maps.Map($("#map").get(0),t),o.infoWindow=new google.maps.InfoWindow({content:$("#info-template").html()}),google.maps.event.addListener(o.infoWindow,"domready",function(){o.initialized||(ko.applyBindings(o.viewModel,document.getElementById("info-window")),o.initialized=!0)});var a=window.mapBounds=new google.maps.LatLngBounds;o.locations=o.viewModel.locationArray();var i=1;ko.utils.arrayForEach(o.locations,function(o){a.extend(e(i,o)),++i}),o.viewModel.locationArray.subscribe(function(e){function t(e){return e.ordinal===this.ordinal}for(var a=0,i=o.locations.length;i>a;a++){var n=o.locations[a],r=ko.utils.arrayFirst(e,t.bind(n))?o.map:null;n.marker.setMap(r)}}),o.resize()},o.setSelected=function(e){o.viewModel.selectedLocation(e),google.maps.event.trigger(o.map,"resize")},o.resize=function(t){var a=$(".map-view"),i=e.topRight();a.offset(i),a.height($(window).height()-i.top),a.width($(window).width()-i.left),window.mapBounds&&(t||google.maps.event.trigger(o.map,"resize"),o.map.fitBounds(window.mapBounds),o.map.setCenter(window.mapBounds.getCenter()))}}function FlickrViewModel(e){"use strict";var o=this;o.viewModel=e,o.imageArray=ko.observableArray([]),o.errorMessage=ko.observable(""),o.flickr=new Flickr({api_key:"562af0fb090c53b310b934fef0c87a7d"}),o.currentWidth=function(){return Number($("#flickr-view").css("width").slice(0,-2))},o.triggerResize=ko.observable(),o.sizeCode=ko.computed(function(){o.triggerResize();var e=o.currentWidth(),t="s";return e>=650?t="z":e>=250?t="m":e>=110&&(t="t"),t}),e.selectedLocation.subscribe(function(e){o.imageArray.removeAll(),o.flickr.photos.search({text:e.name,lat:e.lat,lon:e.lng,radius:.5,geocontext:2},function(e,t){function a(){return"https://farm"+this.farm+".staticflickr.com/"+this.server+"/"+this.id+"_"+this.secret+"_"+o.sizeCode()+".jpg"}if(e)o.errorMessage("Flickr Images could not be loaded.");else{o.errorMessage("");var i=[];for(var n in t.photos.photo){var r=t.photos.photo[n],l={url:ko.observable("https://www.flickr.com/photos/"+r.owner+"/"+r.id),src:ko.computed(a,r)};i.push(l)}ko.utils.arrayPushAll(o.imageArray,i),o.imageArray.valueHasMutated()}})}),o.resize=function(){if(0===o.errorMessage().length){var e=$("#flickr-view"),t=$("#flickr-images"),a=(t.outerHeight()-t.height(),e.offset().top),i=t.offset().top,n=$(window).height()-2*a;e.height(n),t.height(n-i+a),o.triggerResize.notifySubscribers()}}}function WeatherViewModel(e){"use strict";var o=this;o.viewModel=e,o.errorMessage=ko.observable(""),o.temperature=ko.observable(),o.apparentTemperature=ko.observable(),o.dewPoint=ko.observable(),o.humidity=ko.observable(),o.pressure=ko.observable(),o.summary=ko.observable(),o.time=ko.observable(),o.precipProbability=ko.observable(),o.imgSrc=ko.observable(),o.nextDay=ko.observable(),o.nextWeek=ko.observable(),e.selectedLocation.subscribe(function(e){setTimeout(function(){o.errorMessage("Failed to retrieve weather information")},500);$.ajax({url:"https:///api.forecast.io/forecast/2e2344aac39eeec30969f17aff17d447/"+e.lat+","+e.lng+"?units=auto&exclude=minutely,alerts",dataType:"jsonp",success:function(e){function t(e){return e.toFixed(1)+n}function a(e){return 100*Number(e)+"%"}o.errorMessage("");var i="us"===e.flags.units,n="°C",r="hPa";i&&(n="°F",r="mb");var l=e.currently;o.imgSrc("img/"+l.icon+".png"),o.temperature(t(l.temperature)),o.summary(l.summary),o.apparentTemperature(t(l.apparentTemperature)),o.humidity(a(l.humidity)),o.dewPoint(t(l.dewPoint)),o.precipProbability(a(l.precipProbability)),o.pressure(l.pressure+r);var s=new Date;s.setTime(1e3*Number(l.time)),o.time(s.toDateString()+" "+s.toLocaleTimeString()),o.nextDay(e.hourly.summary),o.nextWeek(e.daily.summary)}})}),o.resize=function(){}}ko.bindingHandlers.stopBinding={init:function(){return{controlsDescendantBindings:!0}}},ko.virtualElements.allowedBindings.stopBinding=!0;var locationsDataModel=new LocationsDataModel,locationsViewModel=new LocationsViewModel(locationsDataModel),mapViewModel=new MapViewModel(locationsViewModel),flickrViewModel=new FlickrViewModel(locationsViewModel),weatherViewModel=new WeatherViewModel(locationsViewModel);google.maps.event.addDomListener(window,"resize",function(e){locationsViewModel.resize(),mapViewModel.resize(e),flickrViewModel.resize(),weatherViewModel.resize()});var menu=document.querySelector("#menu"),main=document.querySelector("main"),drawer=document.querySelector(".nav");menu.addEventListener("click",function(e){drawer.classList.toggle("open"),e.stopPropagation()}),main.addEventListener("click",function(){drawer.classList.remove("open")}),$("#close-flickr").click(function(){window.history.back()}),$("#close-weather").click(function(){window.history.back()}),ko.applyBindings(locationsViewModel,document.getElementById("header")),ko.applyBindings(locationsViewModel,document.getElementById("location-list")),ko.applyBindings(flickrViewModel,document.getElementById("flickr")),ko.applyBindings(weatherViewModel,document.getElementById("weather"));